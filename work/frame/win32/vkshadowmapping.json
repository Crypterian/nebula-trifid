{
	"version": 2,
	"engine": "NebulaTrifid",
	"framescript": 
	{
		"renderTextures":
		[
			{ "name": "SpotLightShadowAtlas", 	"format": "G32R32F", "width": 2048, "height": 2048 },
			{ "name": "SpotLightInstance", 		"format": "G32R32F", "width": 512, "height": 512 },
			{ "name": "SpotLightInstanceBlur", 	"format": "G32R32F", "width": 512, "height": 512 },
			{ "name": "GlobalLightShadow",		"format": "G32R32F", "width": 2048, "height": 2048 }
		],
		
		"readWriteTextures":
		[
			{ "name": "GlobalLightShadowFiltered", "format": "A16B16G16R16F", "width": 2048, "height": 2048 }
		],
		
		"depthStencils":
		[
			{ "name":"GlobalLightDepth", "format":"D32S8", "width": 2048, "height": 2048 }
		],
		
		"shaderStates":
		[
			{ 
				"name": "CSMComputeState", "shader":"shd:blur_2d_rg32f_cs", "variables": 
				[
					{ "semantic": "InputImage", "value": "GlobalLightShadow" },
					{ "semantic": "BlurImage", "value": "GlobalLightShadowFiltered" }
				]
			},
			{ 
				"name": "BoxTapHoriSubpass", "shader": "shd:box3taphori", "variables":
				[
					{ "semantic": "SourceBuffer", "value": "SpotLightInstance" }
				]
			},
			{
				"name": "BoxTapVertSubpass", "shader": "shd:box3tapvert", "variables":
				[
					{ "semantic": "SourceBuffer", "value": "SpotLightInstanceBlur" }
				]
			}
		],
		
		"pass":
		{
			"name": "ShadowMapping",
			"attachments":
			[
				{ "name": "SpotLightInstance", "clear": "1000, 1000, 0, 0" },
				{ "name": "SpotLightInstanceBlur" },
				{ "name": "SpotLightShadowAtlas", "store": true },
				{ "name": "GlobalLightShadow", "clear": "1000, 1000, 0, 0", "store": true }
			],
			
			"depthStencil": { "name": "GlobalLightDepth", "clear": 1, "clearStencil": 0 },
			
			"subpass":
			{
				"name": "SpotLightPass",
				"dependencies": [],
				"attachments": [0],
				"system": "LocalShadowsSpot"
			},
			"subpass":
			{
				"name": "SpotLightBlurPass",
				"dependencies": [0],
				"attachments": [1],
				"fullscreenEffect":
				{
					"name": "BlurX",
					"shaderState": "BoxTapHoriSubpass",
					"sizeFromTexture": "SpotLightInstance"
				}
			},
			"subpass":
			{
				"name": "SpotLightResolveToAtlas",
				"dependencies": [1],
				"attachments": [2],				
				"fullscreenEffect":
				{
					"name": "BlurY",
					"shaderState": "BoxTapVertSubpass",
					"sizeFromTexture": "SpotLightInstance"
				}
			},
			"subpass":
			{
				"name": "GlobalLightPass",
				"viewports":
				[
					"0, 0, 1024, 1024",
					"1024, 0, 2048, 1024",
					"0, 1024, 1024, 2048",
					"1024, 1024, 2048, 2048"
				],
				"scissors":
				[
					"0, 0, 1024, 1024",
					"1024, 0, 2048, 1024",
					"0, 1024, 1024, 2048",
					"1024, 1024, 2048, 2048"
				],
				"dependencies": [],
				"attachments": [3],
				"depth": true,
				"system": "GlobalShadows"
			}
		}
	}
}